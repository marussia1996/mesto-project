(()=>{"use strict";var e=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled","disabled"))},t=document.querySelector(".elements"),n=Array.from(document.querySelectorAll(".popup")),r=document.querySelector(".profile"),o=r.querySelector(".profile__name"),c=r.querySelector(".profile__job"),i=r.querySelector(".profile__avatar"),a=document.querySelector(".popup_type_edit"),u=a.querySelector(".form_type_edit"),l=u.querySelector(".form__item_info_name"),s=u.querySelector(".form__item_info_job"),f=document.querySelector(".popup_type_add"),d=f.querySelector(".form_type_add"),_=d.querySelector(".form__item_info_mesto"),m=d.querySelector(".form__item_info_link"),p=document.querySelector(".popup_type_change-avatar"),y=p.querySelector(".form_type_change-avatar"),v=y.querySelector(".form__item_profile_change"),h=document.querySelector(".popup_type_image"),S=h.querySelector(".popup__image"),b=h.querySelector(".popup__signature"),q=r.querySelector(".profile__edit-button"),g=r.querySelector(".profile__add-button"),E=r.querySelector(".profile__button-avatar-change"),L=document.querySelector(".popup_type_delete"),k=a.querySelector(".popup__toggle"),C=f.querySelector(".popup__toggle"),A=h.querySelector(".popup__toggle"),x=p.querySelector(".popup__toggle"),U=L.querySelector(".popup__toggle"),j={baseUrl:"https://nomoreparties.co/v1/plus-cohort-10",headers:{Authorization:"faedd00d-3d28-4943-bdc6-39d59e46ebad","Content-Type":"application/json"}};function I(e){e.classList.add("popup_opened"),document.addEventListener("keydown",w)}function T(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",w)}function w(e){var t=document.querySelector(".popup_opened");"Escape"===e.key&&T(t)}n.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&T(e)}))}));var B=function(e){e.remove(),e=null};function N(e,t,n){!function(e,t){return e.likes.some((function(e){if(e._id===t)return!0}))}(t,n)?e.querySelector(".element__like").classList.remove("element__like_active"):e.querySelector(".element__like").classList.add("element__like_active"),e.querySelector(".element__counter-likes").textContent=t.likes.length}function O(e,n,r,o,c){t.prepend(function(e,t,n,r,o){var c=document.querySelector("#elem-template").content.querySelector(".element").cloneNode(!0);return N(c,e,t),c.querySelector(".element__like").addEventListener("click",(function(){n(c,this,e,t)})),e.owner._id===t?c.querySelector(".element__delete").addEventListener("click",(function(){o(L,e._id,c,r)})):B(c.querySelector(".element__delete")),c.querySelector(".element__text").textContent=e.name,c.querySelector(".element__image").src=e.link,c.querySelector(".element__image").alt=e.name,c.querySelector(".element__image").addEventListener("click",(function(){return t=e.name,n=e.link,I(h),S.src=n,S.alt=t,void(b.textContent=t);var t,n})),c}(e,n,r,o,c))}function P(e,t){t.querySelector(".form__button").textContent=e?"Сохранение...":"Сохранить"}var J,D=function(e){return e.ok?e.json():Promise.reject("ошибка ".concat(e.status))};function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function M(e,t,n,r){var o;t.classList.contains("element__like_active")?(o=n._id,fetch("".concat(j.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:j.headers}).then(D)).then((function(t){N(e,t,r)})).catch((function(e){return console.log("Ошибка при снятии лайка: ".concat(e))})):function(e){return fetch("".concat(j.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:j.headers}).then(D)}(n._id).then((function(t){N(e,t,r)})).catch((function(e){return console.log("Ошибка при установке лайка: ".concat(e))}))}function z(e,t,n,r){I(e),e.querySelector(".popup__button").addEventListener("click",(function(){!function(e,t,n){n(L,t,e)}(t,n,r)}))}function $(e,t,n){(function(e){return fetch("".concat(j.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:j.headers}).then(D)})(n).then((function(n){T(e),B(t.closest(".element"))})).catch((function(e){return console.log("Ошибка при удалении: ".concat(e))}))}function F(e){(function(e){return fetch("".concat(j.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:j.headers,body:JSON.stringify({avatar:e})}).then(D)})(e).then((function(e){return i.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){return console.log("Ошибка при изменении аватара:".concat(e))})).finally((function(){return P(!1,p)}))}function G(e,t){(function(e,t){return fetch("".concat(j.baseUrl,"/users/me"),{method:"PATCH",headers:j.headers,body:JSON.stringify({name:e,about:t})}).then(D)})(e,t).then((function(){return T(a)})).catch((function(e){return console.log("Ошибка при изменении данных: ".concat(e))})).finally((function(){return P(!1,a)}))}Promise.all([fetch("".concat(j.baseUrl,"/users/me"),{headers:j.headers}).then(D).then((function(e){return{profileId:e._id,profileName:e.name,profileJob:e.about,profileAvatar:e.avatar}})).catch((function(e){console.log("Не удалось получить данные пользователя: ".concat(e))})),fetch("".concat(j.baseUrl,"/cards"),{headers:j.headers}).then(D)]).then((function(t){var n,r,a,u=(a=2,function(e){if(Array.isArray(e))return e}(r=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],i=!0,a=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);i=!0);}catch(e){a=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(a)throw o}}return c}}(r,a)||function(e,t){if(e){if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(e,t):void 0}}(r,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=u[0],s=u[1];n=l,o.textContent=n.profileName,c.textContent=n.profileJob,i.style.backgroundImage="url(".concat(n.profileAvatar,")"),s.reverse().forEach((function(e){O(e,l.profileId,M,$,z)})),f.addEventListener("submit",(function(){var t,n,r,o;t=_.value,n=m.value,r=Array.from(d.querySelectorAll(".form__item")),o=d.querySelector(".form__button"),P(!0,f),function(e,t){!function(e,t,n,r,o,c){var i,a;(i=e,a=t,fetch("".concat(j.baseUrl,"/cards"),{method:"POST",headers:j.headers,body:JSON.stringify({name:i,link:a})}).then(D)).then((function(e){return O(e,n,r,o,c)})).catch((function(e){return console.log("Ошибка при добавлении:".concat(e))})).finally((function(){return P(!1,f)}))}(e,t,l.profileId,M,$,z)}(t,n),T(f),d.reset(),e(r,o,{inactiveButtonClass:"form__button_inactive"})}))})).catch((function(e){return console.log("Ошибка при получении данных пользователя: ".concat(e))})),J={formSelector:".form",formEditClass:"form_type_edit",inputSelector:".form__item",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active"},Array.from(document.querySelectorAll(J.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(t,n){var r=Array.from(t.querySelectorAll(n.inputSelector)),o=t.querySelector(n.submitButtonSelector);t.classList.contains(n.formEditClass)||e(r,o,n),r.forEach((function(c){c.addEventListener("input",(function(){e(r,o,n),function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(t,c,n)}))}))}(t,J)})),a.addEventListener("submit",(function(){return function(e){var t=l.value,n=s.value;o.textContent=t,c.textContent=n,P(!0,a),e(t,n)}(G)})),p.addEventListener("submit",(function(){return function(t){var n=v.value;P(!0,p),t(n);var r=Array.from(y.querySelectorAll(".form__item")),o=y.querySelector(".form__button");T(p),y.reset(),e(r,o,{inactiveButtonClass:"form__button_inactive"})}(F)})),q.addEventListener("click",(function(){l.value=o.textContent,s.value=c.textContent,I(a)})),g.addEventListener("click",(function(){I(f)})),E.addEventListener("click",(function(){I(p)})),k.addEventListener("click",(function(){T(a)})),C.addEventListener("click",(function(){T(f)})),A.addEventListener("click",(function(){T(h)})),x.addEventListener("click",(function(){T(p)})),U.addEventListener("click",(function(){T(L)}))})();